# Валідація форм

## Встановлені пакети
- `vee-validate` - бібліотека для валідації форм у Vue 3
- `yup` - схема валідації
- `@vee-validate/yup` - інтеграція yup з vee-validate

## Правила валідації

### Логін
- **Email**: обов'язкове поле, має бути валідний email
- **Password**: обов'язкове поле, мінімум 6 символів

### Реєстрація
- **Name**: обов'язкове поле, мінімум 3 символи
- **Email**: обов'язкове поле, має бути валідний email
- **Password**: обов'язкове поле, мінімум 6 символів

## Обробка помилок від бакенду

### 401 Unauthorized
Відображається загальна помилка: "Невірні дані для входу"

### 422 Unprocessable Entity
Відображаються помилки валідації для кожного поля окремо

Приклади відповідей:
```json
{
  "message": "The email field is required.",
  "errors": {
    "email": ["The email field is required."]
  }
}
```

```json
{
  "message": "The email has already been taken.",
  "errors": {
    "email": ["The email has already been taken."]
  }
}
```

## Змінені файли

### src/composables/useAuthForm.ts (НОВИЙ)
Композбл для управління формою автентифікації:
- **Схеми валідації**: loginSchema та registerSchema через Yup
- **Обробка форми**: useForm з VeeValidate
- **Обробка помилок**: handleServerError для 401 та 422 помилок
- **Методи логіну/реєстрації**: login та register з обробкою помилок
- **Керування станом**: clearErrors, resetFormState
- **Автоматичний редірект**: при успішному логіні
- **Повертає**:
  - `generalError` - загальна помилка для відображення
  - `onSubmit` - обробник сабміту форми
  - `resetFormState` - скидання стану форми
  - `clearErrors` - очищення помилок

### src/components/auth/AuthForm.vue
- Спрощений до мінімуму - тільки UI логіка
- Використовує композбл `useAuthForm`
- Обробляє подію `registerSuccess`
- Скидає форму при зміні режиму (логін/реєстрація)
- Відображає загальні помилки через alert
- Всього ~30 рядків коду замість ~110

### src/components/ui/InputField.vue
- Додано інтеграцію з VeeValidate через `useField`
- Додано відображення помилок валідації під полем
- Додано стилі для помилок (червоний бордер та текст помилки)

### Структура композблів
```
src/composables/
├── useAuthForm.ts      # Валідація та обробка форми авторизації
├── useChatLogic.ts     # Існуючий
├── useChatWebSocket.ts # Існуючий
└── useRoleGuard.ts     # Існуючий
```

## Переваги
- ✅ Валідація на стороні клієнта перед відправкою запиту
- ✅ Чіткі повідомлення про помилки для користувача
- ✅ Візуальне виділення полів з помилками
- ✅ Обробка помилок від бакенду та їх відображення
- ✅ Динамічна схема валідації залежно від режиму форми (логін/реєстрація)
- ✅ **Переиспользуваність**: логіка валідації може використовуватись в інших формах
- ✅ **Тестованість**: композбл легко тестувати окремо від UI
- ✅ **Читабельність**: компонент AuthForm тепер ~30 рядків замість ~110
- ✅ **Підтримка**: вся бізнес-логіка в одному місці
- ✅ **Розділення відповідальностей**: UI в компоненті, логіка в композблі
